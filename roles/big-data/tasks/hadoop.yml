- name: check if hadoop is already installed
  stat: path={{ home }}/opt/hadoop-2.4.1
  register: hadoop_path

- name: download Hadoop
  get_url: url=http://ftp.unicamp.br/pub/apache/hadoop/common/hadoop-2.4.1/hadoop-2.4.1.tar.gz dest=/tmp/hadoop-2.4.1.tar.gz
  when: hadoop_path.stat.exists == False

- name: unpack Hadoop
  unarchive: src=/tmp/hadoop-2.4.1.tar.gz dest="{{ home }}/opt"
  when: hadoop_path.stat.exists == False

- name: create link
  file: dest="{{ home }}/opt/hadoop" src="{{ home }}/opt/hadoop-2.4.1" state=link

- name: add Hadoop env vars
  lineinfile: dest={{ home }}/.profile line={{ item }}
  with_items:
    - HADOOP_INSTALL={{ home }}/opt/hadoop
    - PATH=\"$PATH:$HADOOP_INSTALL/bin\"
    - PATH=\"$PATH:$HADOOP_INSTALL/sbin\"
    - HADOOP_MAPRED_HOME=\"$HADOOP_INSTALL\"
    - HADOOP_COMMON_HOME=\"$HADOOP_INSTALL\"
    - HADOOP_HDFS_HOME=\"$HADOOP_INSTALL\"
    - YARN_HOME=\"$HADOOP_INSTALL\"

# add to hadoop-env.sh
# export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-i386
# add to core-site.xml:
# <property>
#     <name>fs.default.name</name>
#     <value>hdfs://localhost:9000</value>
# </property>
#
# add to yarn-site.xml:
# <property>
#     <name>yarn.nodemanager.aux-services</name>
#     <value>mapreduce_shuffle</value>
# </property>
# <property>
#     <name>yarn.nodemanager.aux-services.mapreduce.shuffle.class</name>
#     <value>org.apache.hadoop.mapred.ShuffleHandler</value>
# </property>
#
# create and add to mapred-site.xml:
# <property>
#     <name>mapreduce.framework.name</name>
#     <value>yarn</value>
# </property>
#
# add to hdfs-site.xml:
# <property>
#     <name>dfs.replication</name>
#     <value>1</value>
# </property>
# <property>
#     <name>dfs.namenode.name.dir</name>
#     <value>file:$HOME/opt/hadoop_store/hdfs/namenode</value>
# </property>
# <property>
#     <name>dfs.datanode.data.dir</name>
#     <value>file:$HOME/opt/hadoop_store/hdfs/datanode</value>
# </property>
